<div class="bg-[#F0F7F8] text-[#006D77] font-nunito relative overflow-hidden">
  @if (config().advancedFeatures.fallingEffects) {
    <div class="falling-flowers">
        <i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i>
    </div>
  }
  <div class="relative z-10">
    <a routerLink="/home" class="fixed top-4 left-4 z-50 bg-white/80 backdrop-blur-sm text-[#006D77] px-4 py-2 rounded-full shadow-md hover:bg-white transition">← Back to Templates</a>

    <!-- Hero Section -->
    <header class="h-screen flex items-center justify-center text-center p-4 relative overflow-hidden">
       <!-- Slideshow Container -->
      @for(image of slideImages(); track image; let i = $index) {
        <div 
          class="absolute inset-0 w-full h-full bg-cover bg-center transition-opacity duration-[2000ms] ease-in-out"
          [style.background-image]="'url(' + image + ')'"
          [class.opacity-100]="i === currentSlideIndex()"
          [class.opacity-0]="i !== currentSlideIndex()">
          <div 
            class="w-full h-full slide-animation" 
            [class]="i === currentSlideIndex() ? currentAnimation() : ''">
          </div>
        </div>
      }
      <div class="absolute inset-0 bg-black/30"></div>
      <div class="relative z-10 text-white bg-black/20 backdrop-blur-sm p-10 rounded-lg" appFadeIn>
        <p class="text-2xl">{{ config().galleryTitle?.['greeting'] || '' }}</p>
        <h1 class="text-7xl md:text-9xl font-pacifico my-4">{{ config().couple.groom.name }} & {{ config().couple.bride.name }}</h1>
        <p class="text-2xl font-light">{{ getFormattedDate() }}</p>
      </div>
    </header>

    <!-- Countdown Section -->
    @if (config().sectionVisibility.countdown) {
      <section class="py-24" appFadeIn>
        <div class="container mx-auto text-center px-4">
          <h2 class="text-5xl font-pacifico text-[#83C5BE]">{{ config().galleryTitle?.['countdownTitle'] || '' }}</h2>
          <div class="w-48 mx-auto my-6 text-[#83C5BE]/70">
            <svg viewBox="0 0 100 10" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M0,5 C20,0, 30,10, 50,5 S 80,0, 100,5" stroke="currentColor" stroke-width="1.5" fill="none"/>
              <circle cx="50" cy="5" r="1.5" fill="currentColor"/>
            </svg>
          </div>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-8 max-w-3xl mx-auto mt-12">
            @for (item of [['days', timeLeft().days], ['hours', timeLeft().hours], ['minutes', timeLeft().minutes], ['seconds', timeLeft().seconds]]; track item[0]) {
              <div class="p-6 rounded-lg bg-white shadow-md border-t-4 border-t-[#83C5BE]">
                <p class="text-6xl font-nunito font-bold text-[#006D77]">{{ item[1] }}</p>
                <p class="text-[#006D77]/70 uppercase tracking-wider">{{ item[0] }}</p>
              </div>
            }
          </div>
        </div>
      </section>
    }

    <!-- Couple Section -->
    @if (config().sectionVisibility.couple) {
      <section class="py-24" appFadeIn>
        <div class="container mx-auto px-4 max-w-5xl">
          <div class="grid md:grid-cols-2 gap-16 items-center">
            <div class="text-center">
              <img [src]="config().couple.groom.image" class="w-48 h-48 rounded-full mx-auto object-cover shadow-lg ring-4 ring-offset-4 ring-[#83C5BE] ring-offset-[#F0F7F8]">
              <h3 class="text-4xl font-pacifico mt-8 text-[#006D77]">{{ config().couple.groom.name }}</h3>
              <p class="text-[#006D77]/80 mt-2">{{ config().couple.groom.parents }}</p>
              <p class="text-[#006D77] mt-4 italic">"{{ config().couple.groom.wittyDescription }}"</p>
            </div>
            <div class="text-center">
              <img [src]="config().couple.bride.image" class="w-48 h-48 rounded-full mx-auto object-cover shadow-lg ring-4 ring-offset-4 ring-[#83C5BE] ring-offset-[#F0F7F8]">
              <h3 class="text-4xl font-pacifico mt-8 text-[#006D77]">{{ config().couple.bride.name }}</h3>
              <p class="text-[#006D77]/80 mt-2">{{ config().couple.bride.parents }}</p>
              <p class="text-[#006D77] mt-4 italic">"{{ config().couple.bride.wittyDescription }}"</p>
            </div>
          </div>
          <div class="text-center mt-20 max-w-3xl mx-auto">
            <p class="text-2xl font-pacifico text-[#83C5BE] italic">"{{ config().loveQuote.text }}"</p>
            <p class="mt-2 text-gray-500">- {{ config().loveQuote.author }} -</p>
          </div>
        </div>
      </section>
    }

    <!-- Story Section -->
    @if (config().sectionVisibility.story) {
      <section class="py-24 bg-white" appFadeIn>
        <div class="container mx-auto px-4 max-w-4xl text-center">
          <h2 class="text-5xl font-pacifico text-[#83C5BE]">{{ config().loveStory.title }}</h2>
          <div class="w-48 mx-auto my-6 text-[#83C5BE]/70">
            <svg viewBox="0 0 100 10" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M0,5 C20,0, 30,10, 50,5 S 80,0, 100,5" stroke="currentColor" stroke-width="1.5" fill="none"/>
              <circle cx="50" cy="5" r="1.5" fill="currentColor"/>
            </svg>
          </div>
          <div class="mt-16">
            @for (milestone of config().loveStory.milestones; track $index; let isOdd = $odd) {
              <div class="flex flex-col md:flex-row gap-8 items-center mb-12" [class.md:flex-row-reverse]="isOdd">
                <div class="w-full md:w-1/3">
                  <img [src]="milestone.image" alt="story" class="w-full h-auto object-cover rounded-lg shadow-xl transform" [class.rotate-3]="isOdd" [class.-rotate-3]="!isOdd">
                </div>
                <div class="w-full md:w-2/3 text-left">
                  <p class="font-bold text-xl text-[#006D77]">{{ formatStoryDate(milestone.date) }}</p>
                  <p class="text-lg text-[#006D77]/90 mt-2">{{ milestone.content }}</p>
                </div>
              </div>
            }
          </div>
        </div>
      </section>
    }

    <!-- Gallery Section -->
    @if (config().sectionVisibility.gallery) {
      <section class="py-24" appFadeIn>
        <div class="container mx-auto px-4 text-center">
          <h2 class="text-5xl font-pacifico text-[#83C5BE]">{{config().galleryTitle?.['title'] || 'Kho ảnh'}}</h2>
          <div class="w-48 mx-auto my-6 text-[#83C5BE]/70">
            <svg viewBox="0 0 100 10" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M0,5 C20,0, 30,10, 50,5 S 80,0, 100,5" stroke="currentColor" stroke-width="1.5" fill="none"/>
              <circle cx="50" cy="5" r="1.5" fill="currentColor"/>
            </svg>
          </div>
          <div class="flex justify-center gap-4 mb-8">
            @for(category of galleryCategories(); track category) {
              <button (click)="selectCategory(category)" 
                      [class.bg-[#006D77]]="activeCategory() === category"
                      [class.text-white]="activeCategory() === category"
                      [class.bg-white]="activeCategory() !== category"
                      [class.text-[#006D77]]="activeCategory() !== category"
                      class="px-6 py-2 rounded-full shadow-md transition-colors duration-300">
                {{ config().galleryTitle?.[category] || category }}
              </button>
            }
          </div>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            @for(image of activeImages(); track $index) {
              <div class="overflow-hidden rounded-lg shadow-lg" (click)="openLightbox($index)">
                <img [src]="image" class="w-full h-full object-cover transform hover:scale-110 transition-transform duration-500 cursor-pointer">
              </div>
            }
          </div>
        </div>
      </section>
    }

    <!-- Event & Map Section -->
    @if (config().sectionVisibility.event) {
      <section class="py-24 bg-cover bg-center" [style.background-image]="'url(' + config().receptionDetails.backgroundImg + ')'" appFadeIn>
        <div class="container mx-auto px-4 text-center">
          <h2 class="text-5xl font-pacifico text-white" style="text-shadow: 2px 2px 4px rgba(0,0,0,0.5)">{{config().galleryTitle?.['weddingDetail'] || ''}}</h2>
          <div class="w-48 mx-auto my-6 text-white/70">
            <svg viewBox="0 0 100 10" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M0,5 C20,0, 30,10, 50,5 S 80,0, 100,5" stroke="currentColor" stroke-width="1.5" fill="none"/>
              <circle cx="50" cy="5" r="1.5" fill="currentColor"/>
            </svg>
          </div>
          <div class="grid lg:grid-cols-3 gap-8 mt-12">
            @for (location of [config().mainEvent, config().couple.groom.homeLocation, config().couple.bride.homeLocation]; track location.name) {
              <div class="bg-white/90 backdrop-blur-sm p-6 rounded-lg shadow-lg flex flex-col">
                <h3 class="text-2xl font-nunito font-bold mb-4 text-[#006D77]">{{ location.name }}</h3>
                <p class="text-sm text-[#006D77]/80 mb-1">{{ location.des }}</p>
                @if(location === config().mainEvent) {
                    <p class="text-sm text-[#006D77]/80 mb-1"><strong>Địa điểm:</strong> {{ location.venue }}</p>
                    <p class="text-sm text-[#006D77]/80 mb-1"><strong>Địa chỉ:</strong> {{ location.address }}</p>
                    <p class="text-sm text-[#006D77]/80 mb-4"><strong>Thời gian:</strong> {{ getFormattedTime() }}</p>
                }
                <div class="w-full h-64 rounded-lg shadow-md overflow-hidden mt-auto">
                  <iframe [src]="location.mapUrl | safeUrl" width="100%" height="100%" style="border:0;" allowfullscreen="" loading="lazy"></iframe>
                </div>
              </div>
            }
          </div>
        </div>
      </section>
    }
    
    <!-- Gifting Section -->
    @if (config().sectionVisibility.gifting) {
      <section class="py-24 bg-white" appFadeIn>
        <div class="container mx-auto px-4 text-center max-w-4xl">
          <h2 class="text-5xl font-pacifico text-[#83C5BE]">{{ config().gifting.title }}</h2>
          <div class="w-48 mx-auto my-6 text-[#83C5BE]/70">
            <svg viewBox="0 0 100 10" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M0,5 C20,0, 30,10, 50,5 S 80,0, 100,5" stroke="currentColor" stroke-width="1.5" fill="none"/>
              <circle cx="50" cy="5" r="1.5" fill="currentColor"/>
            </svg>
          </div>
          <p class="text-lg text-[#006D77] mb-12">{{ config().gifting.intro }}</p>
          <div class="grid md:grid-cols-2 gap-8">
              @for (gift of [config().gifting.groom, config().gifting.bride]; track gift.accountHolder) {
                <div class="bg-white p-6 rounded-lg shadow-lg border border-gray-200">
                  <h3 class="text-2xl font-pacifico text-[#006D77] mb-4">For the {{ gift === config().gifting.groom ? 'Groom' : 'Bride' }}</h3>
                  <img [src]="gift.qrCodeUrl" [alt]="gift.accountHolder + ' QR Code'" class="w-32 h-32 mx-auto rounded-md">
                  <p class="mt-4 text-sm text-gray-500">{{ gift.bankName }}</p>
                  <p class="font-semibold">{{ gift.accountHolder }}</p>
                  <p class="text-gray-600 text-sm">{{ gift.accountNumber }}</p>
                  <button (click)="copyToClipboard(gift.accountNumber, gift === config().gifting.groom ? 'groom' : 'bride')" class="mt-4 text-sm px-4 py-2 rounded-full transition-colors duration-300 w-full" [class.bg-green-500]="(gift === config().gifting.groom ? copiedGroom() : copiedBride())" [class.bg-[#83C5BE]]="(gift !== config().gifting.groom ? !copiedBride() : !copiedGroom())" [class.text-white]="true">
                      {{ (gift === config().gifting.groom ? copiedGroom() : copiedBride()) ? 'Copied!' : 'Copy Account Number' }}
                  </button>
                </div>
              }
          </div>
        </div>
      </section>
    }

    <!-- Mini Game Section -->
    @if (config().sectionVisibility.miniGame) {
      <section class="py-24" appFadeIn>
        <app-mini-game />
      </section>
    }

    <!-- Guestbook Section -->
    @if (config().sectionVisibility.guestbook) {
      <section class="py-24 bg-white" appFadeIn>
        <div class="container mx-auto px-4 max-w-3xl text-center">
          <h2 class="text-5xl font-pacifico text-[#83C5BE]">{{ config().guestbook.title }}</h2>
          <div class="w-48 mx-auto my-6 text-[#83C5BE]/70">
            <svg viewBox="0 0 100 10" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M0,5 C20,0, 30,10, 50,5 S 80,0, 100,5" stroke="currentColor" stroke-width="1.5" fill="none"/>
              <circle cx="50" cy="5" r="1.5" fill="currentColor"/>
            </svg>
          </div>
          <p class="text-lg text-[#006D77] mb-8">{{ config().guestbook.intro }}</p>
          
          <div class="bg-white p-8 rounded-lg shadow-lg mb-8">
            <form [formGroup]="guestbookForm" (ngSubmit)="submitGuestbookMessage()">
              <input type="text" formControlName="name" class="w-full px-4 py-3 mb-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#83C5BE]" placeholder="Tên của bạn">
              <textarea formControlName="message" rows="4" class="w-full px-4 py-3 mb-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#83C5BE]" placeholder="Lời chúc..."></textarea>
              <button type="submit" [disabled]="guestbookForm.invalid" class="w-full bg-[#006D77] text-white font-bold px-6 py-3 rounded-lg hover:bg-[#005a61] transition-colors duration-300 disabled:bg-[#83C5BE]/50">
                Gửi lời chúc
              </button>
            </form>
          </div>
    
          <div class="space-y-6">
            @for (message of guestbookMessages(); track $index) {
              <div class="bg-white p-6 rounded-lg shadow-md border-l-4 border-[#83C5BE]">
                <p class="text-[#006D77] italic">"{{ message.message }}"</p>
                <p class="text-right text-[#83C5BE] mt-2 font-bold font-pacifico">- {{ message.name }}</p>
              </div>
            }
          </div>
        </div>
      </section>
    }

    <!-- Thank You Section -->
    @if (config().sectionVisibility.thankYou) {
      <section class="py-24 bg-white" appFadeIn>
        <div class="container mx-auto px-4 text-center max-w-3xl">
          <h2 class="text-5xl font-pacifico text-[#83C5BE]">{{ config().thankYou.title }}</h2>
          <div class="w-48 mx-auto my-6 text-[#83C5BE]/70">
            <svg viewBox="0 0 100 10" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M0,5 C20,0, 30,10, 50,5 S 80,0, 100,5" stroke="currentColor" stroke-width="1.5" fill="none"/>
              <circle cx="50" cy="5" r="1.5" fill="currentColor"/>
            </svg>
          </div>
          <p class="text-lg text-[#006D77] mt-8">{{ config().thankYou.message }}</p>
        </div>
      </section>
    }

    <!-- Footer -->
    <footer class="bg-[#83C5BE] text-white text-center pt-24 pb-8 relative">
      <div class="ocean">
        <div class="wave"></div>
        <div class="wave"></div>
      </div>
      <div class="relative z-10">
        <p>
          With love from <a [href]="config().footer.authorLink" target="_blank" class="font-bold hover:underline">{{ config().footer.authorName }}</a>
        </p>
      </div>
    </footer>
  </div>
</div>

@if (isLightboxOpen() && selectedImageUrl()) {
  <app-lightbox 
    [imageUrl]="selectedImageUrl()!"
    (onClose)="closeLightbox()"
    (onNext)="nextImage()"
    (onPrev)="prevImage()" />
}